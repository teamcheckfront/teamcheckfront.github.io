// faceswp
jQuery('document').ready(function($){
    $(document).on("mouseup",function(e) 
    {
        var container = $("li.search-box");
        if (!container.is(e.target) && container.has(e.target).length === 0) 
        {
            container.removeClass("active");
        }
    });
    $(document).on("click","#qa-search-link",function(){
        $(this).parents(".search-box").toggleClass("active"); 
        $(this).parents(".search-box").find(".aa-input").focus();
    }) 
    $(document).on("click",".diamond-details-section .details-inner-section > h2",function(){
        var __t = $(this);
        $(this).toggleClass("open");
        $(this).next().toggleClass("open");
        if($(this).hasClass("open")){
           setTimeout(function(){
                $('html, body').animate({
                    scrollTop: __t.offset().top-140
                }, 200);   
           },200)
        }       
    }) 
    //
    //    product archive
    //
    $(document).on("keydown","input.facetwp-number",function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl/cmd+A
            (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+C
            (e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+X
            (e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
                 return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    });

    $(document).on("click",".facetwp-type-radio .all",function(){
        $(this).addClass("checked");
        var face = $(this).closest(".facetwp-facet");
        var face_name = face.attr("data-name");
        if(face.find(".checked").not(".all").size()>0){
            FWP.reset(face_name);
        }
        return false;
    })
    $(".advanced-filter .hide-show-advanced-link").click(function(){
        if(!$(this).hasClass("show")){
            $(this).addClass("show");
            $(this).text($(this).attr("data-hide"));
            $(this).next(".filter-columns").slideDown();
        }else{
            $(this).removeClass("show");
            $(this).text($(this).attr("data-show"));
            $(this).next(".filter-columns").slideUp();
        }
    })

    $(".facetwp-sort-select").selectBoxIt();
    $(document).on('facetwp-loaded', function() {

        $(".facetwp-sort-select").selectBoxIt();

        /* facetwp-type-new_number_range */
        FWP.hooks.addAction('facetwp/refresh/new_number_range', function($this, facet_name) {
            var min = $this.find('.facetwp-number-min').val() || '';
            var max = $this.find('.facetwp-number-max').val() || '';
            FWP.facets[facet_name] = ('' !== min || '' !== max) ? [min, max] : [];
        });
        FWP.hooks.addFilter('facetwp/selections/new_number_range', function(output, params) {
            return params.selected_values[0] + ' - ' + params.selected_values[1];
        });

        $(document).on('click', '.facetwp-type-new_number_range .facetwp-submit', function() {
            FWP.refresh();
        });

        /* facetwp-type-radio add show all */
        $(".facetwp-type-radio").each(function(){
             /*
            var _t = $(this);
            if(_t.find(".all").size()<=0){
                var pre_title = _t.closest(".filter-contents").find(".filter-title").attr("data-title");

                if (typeof pre_title !== typeof undefined && pre_title !== false) {
                    var all = '<div class="all">'+pre_title+'</div>';
                }else{
                     var all = '<div class="all">ALL</div>';
                }

                _t.prepend(all);
            }
           
            if(_t.find(".checked").not(".all").size()<=0){
               _t.find(".all").addClass("checked");
            }
            _t.find(".facetwp-radio").not(".all").each(function(){
                if ($(this).text().indexOf("Only ") < 0){
                  $(this).prepend("Only ")
                }
            })*/
        })

         $(".filter-content .facetwp-type-number_range input.facetwp-number").change(function(){
             var _t = $(this).closest('.facetwp-facet');
             var min = _t.find(".facetwp-number-min");
             var max = _t.find(".facetwp-number-max");

             if(Number(min.val())<Number(max.val())){
                 _t.find(".facetwp-submit").click();
             }else{
                // var minn = min.val();
                // var maxx = max.val();
                // min.val(maxx);
                // max.val(minn);
                 _t.find(".facetwp-submit").click();
             }
         })
        $(".filter-content .facetwp-type-number_range input.facetwp-number,.filter-content .facetwp-type-new_number_range input.facetwp-number").each(function(){
             $(this).attr("type","number");
             if($(this).hasClass("facetwp-number-min")){
                 $(this).attr("placeholder","FROM");
             }else{
                 $(this).attr("placeholder","TO");
             }
         })

       for ( obj in FWP.facet_type) {
            if (typeof FWP.facet_type[obj] !== 'function'&&(FWP.facet_type[obj]=="number_range"||FWP.facet_type[obj]=="new_number_range")) {
                var min = $(".facetwp-facet-"+obj).find(".facetwp-number-min");
                var max = $(".facetwp-facet-"+obj).find(".facetwp-number-max");
                if(FWP.facets[obj]){
                    min.val(FWP.facets[obj][0]);
                    max.val(FWP.facets[obj][1]);
                }
            }
        }

        make_filter_active();




    });
    // paging scrool

    $(document).on('facetwp-refresh', function() {
        if (FWP.loaded) {
            $('.facetwp-template').prepend('<div class="loading">Loading</div>');
        }
    });
    $(".filter-bottom .close-bt").click(function(){
         $(this).closest('#siderbar').slideUp(500,function(){
             $('#siderbar').addClass("hide-for-active");
             $(".second-menu").addClass("open-actived");
              $("body").addClass("close-filtered");
         })
    })
    $(".filter-active .bt-show-filter").click(function(){

        $('#siderbar').slideDown(function(){
             $('#siderbar').removeClass("hide-for-active");
             $(".second-menu").removeClass("open-actived");
             $("body").removeClass("close-filtered");
             $('html, body').animate({
                    scrollTop:  $('#siderbar').offset().top-50
            }, 400);
         })
        return false;
    })
    $(".filter-bottom .search-bt").click(function(){
        FWP.refresh();
       $(".facetwp-template").slideDown(function(){
            $(".facetwp-template").addClass("show");
            $('html, body').animate({
                scrollTop: $(".facetwp-template").offset().top-110
            }, 400);
        })
       return false;
    })


    //
    //    product single
    //



    // compare form validate
    $(".send-wishlist").validate({
         rules: {
            // simple rule, converted to {required:true}
            w_message: "required",
            // compound rule
            w_email: {
              required: true,
              email: true
            },
            f_email: {
              required: true,
              email: true
            }
          },
         highlight: function(element, errorClass, validClass) {           $(element).addClass(errorClass).removeClass(validClass);},
         unhighlight: function(element, errorClass, validClass) { $(element).removeClass(errorClass).addClass(validClass);},
         });

    // back button
    var history_url = document.referrer;
    if(history_url!=="" ){
        if(history_url.indexOf("product") == -1){
             var new_url = history_url+"#back";
            $(".back-icon a").attr("href",new_url);
        }
    }

    // search form click
    $("div.search-icon > a").click(function(event){
        $(this).parent().toggleClass("active");
        setTimeout(function(){
            $("div.search-icon input[type='text']").focus();
        },500)
         event.stopPropagation();
        return false;
    })
    $("div.search-icon > form .close-search").click(function(){
        $(this).parents("div.search-icon").removeClass("active");
    })

    $('div.search-icon > form,div.search-icon > a').click(function(event){
        event.stopPropagation();
    });
    $(window).click(function() {
        $("div.search-icon").removeClass("active");
    });



    jQuery.extend(jQuery.validator.messages, {
        required: "Please complete this required field.",
        remote: "Please fix this field.",
        email: "Please enter a valid email address.",
        url: "Please enter a valid URL.",
        date: "Please enter a valid date.",
        dateISO: "Please enter a valid date (ISO).",
        number: "Please enter a valid number.",
        digits: "Please enter only digits.",
        creditcard: "Please enter a valid credit card number.",
        equalTo: "Please enter the same value again.",
        accept: "Please enter a value with a valid extension.",
        maxlength: jQuery.validator.format("Please enter no more than {0} characters."),
        minlength: jQuery.validator.format("Please enter at least {0} characters."),
        rangelength: jQuery.validator.format("Please enter a value between {0} and {1} characters long."),
        range: jQuery.validator.format("Please enter a value between {0} and {1}."),
        max: jQuery.validator.format("Please enter a value less than or equal to {0}."),
        min: jQuery.validator.format("Please enter a value greater than or equal to {0}.")
    });
});

jQuery(window).load(function(){
    // click to search if back button click;
    var url = window.location.href;
    var hash = window.location.hash;
    //if(url.indexOf("?") !== -1){
        if(hash.indexOf("back") !== -1){
             jQuery(".filter-bottom .search-bt").click();
        }
   // }

    // click to search if is search page
    if(url_query("s")==1){
        jQuery(".filter-bottom .search-bt").click();
    }

    // add scroll top when page click
    jQuery(document).on("click",".facetwp-page",function(){
        //if(jQuery("body").hasClass("archive")){
             var _o = 120;
             if(jQuery(window).width()<=767){
                 _o = 0;
             }
             jQuery('html, body').animate({ scrollTop: jQuery(".facetwp-template").offset().top - _o }, 500);
        //}
    })
})


function make_filter_active(){
    html ="";

    jQuery(".facetwp-facet").each(function(){
        var _t = jQuery(this);
        if(_t.html()==""){
            _t.closest('.filter-contents').addClass("filter-hide");
        }else{
            _t.closest('.filter-contents').removeClass("filter-hide");
            if(_t.hasClass("facetwp-type-number_range")||_t.hasClass("facetwp-type-new_number_range")){
                if(Number(_t.find(".facetwp-number-min").val())>0 && Number(_t.find(".facetwp-number-max").val())<=0 ){
                     html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                     html +="<span>From - "+Number(_t.find(".facetwp-number-min").val())+"</span> ";
                     html +="</dd>";
                }else if( Number(_t.find(".facetwp-number-min").val())<=0 && Number(_t.find(".facetwp-number-max").val())>0  ){
                     html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                     html +="<span>0 - "+Number(_t.find(".facetwp-number-max").val())+"</span> ";
                     html +="</dd>";
                }else if (Number(_t.find(".facetwp-number-min").val())> 0 && Number(_t.find(".facetwp-number-max").val())>0 ){
                     html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                     html +="<span>"+Number(_t.find(".facetwp-number-min").val())+" - "+Number(_t.find(".facetwp-number-max").val())+"</span> ";
                     html +="</dd>";
                }
            }else if(_t.hasClass("facetwp-type-slider")){
                var facet_name = _t.attr('data-name');
                var opts = FWP.settings[facet_name];

               if((opts.range.min!=opts.lower)||(opts.range.max!=opts.upper)){
                    html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                    html +="<span>"+_t.find(".facetwp-slider-label").text()+"</span> ";
                    html +="</dd>";
               }
            }else if(_t.hasClass("facetwp-type-checkboxes")){
                if(_t.find(".checked").size()>0){
                    html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                    _t.find(".checked").each(function(){
                       var text  = jQuery(this).clone();
                       text.find(".facetwp-counter").remove();
                       html +="<span>"+text.text()+"</span> ";
                    })
                     html +="</dd>";
                }
            }else if(_t.hasClass("facetwp-type-radio")){
                if(_t.find(".checked").not(".all").size()>0){
                    html +="<dt>"+_t.closest('.filter-contents').find(".filter-title").text()+"</dt><dd>";
                    _t.find(".checked").each(function(){
                       var text  = jQuery(this).clone();
                       text.find(".facetwp-counter").remove();
                       html +="<span>"+text.text()+"</span> ";
                    })
                     html +="</dd>";
                }
            }
        }
    })

    jQuery(".filter-active dl").html(html);
    if(jQuery(".filter-active dl dd").size()>0){
        jQuery(".filter-bottom .reset-bt").css({"display":"inline-block"})
    }else{
         jQuery(".filter-bottom .reset-bt").css({"display":"none"})
    }
    jQuery(".filter-bottom .reset-bt").click(function(){
        FWP.reset();
        jQuery(".filter-contents").removeClass("filter-hide");
    })
}

// function get url paramaster

function url_query(field){

var url = window.location.href;
if(url.indexOf('?' + field + '=') != -1)
    return 1;
else if(url.indexOf('&' + field + '=') != -1)
    return 1;
return 0;
}




// shop products faces wp
jQuery('document').ready(function($){
    int_only_for_shop();
    hide_empty_price();
})
jQuery(window).load(function(){
    setTimeout(function(){fixed_filter_on_scroll()},1000);
})
function int_only_for_shop(){
    click_active_shop_widget_fwp_title();
    product_archive_filters_custom ();
}
function fixed_filter_on_scroll(){

}
function click_active_shop_widget_fwp_title(){
    jQuery(".shop-widget").mouseleave(function() {
        //jQuery(".shop-widget").removeClass("open-filter");
    })
    jQuery(document).click(function(event){
        if (!jQuery(event.target).is(".fwp-content, .fwp-content *")) {
           jQuery(".shop-widget").removeClass("open-filter");
        }
    })
    jQuery(".shop-widget .fwp-title").click(function(event){
         event.stopPropagation();
        var widget = jQuery(this).closest(".shop-widget");
        jQuery(".shop-widget").not(widget).removeClass("open-filter");
        if(widget.hasClass("open-filter")){
            widget.removeClass("open-filter");
        }else{
            widget.addClass("open-filter");
        }
    })
     jQuery(document).on("click",".last-page-content .back-top a",function(e){
        e.preventDefault();
         jQuery('html, body').animate({
                scrollTop: 0
            }, 400);
    })
    jQuery(".filter-mobile-icon").click(function(){
        jQuery(this).parent().find(".shop-widget").not(".first").slideToggle();
    })
}
function hide_empty_price(){
    jQuery(".woocommerce #wrapper ul.products li.product .price, .woocommerce-page #wrapper ul.products li.product .price").each(function(){
                if(jQuery(this).find(".amount").size()<=0){
                    jQuery(this).remove();
                }
            })
}
function product_archive_filters_custom (){
    jQuery(document).on("click",".facetwp-type-checkboxes .all",function(){
        jQuery(this).addClass("checked");
        var face = jQuery(this).closest(".facetwp-facet");
        var face_name = face.attr("data-name");
        if(face.find(".checked").not(".all").size()>0){
            FWP.reset(face_name);
        }
        return false;
    })
    jQuery(document).on('facetwp-loaded', function() {
             var bLazy = new Blazy();
            bLazy.revalidate();
        replace_face_name();
            var count = jQuery(".facetwp-counts").text();
            //console.log(count);
            if(count=="0 items"){
                //jQuery(".faces-wp-filters").hide();
            }else{
                jQuery(".faces-wp-filters").show();
            }

           jQuery(".shop-widget .menu").each(function(){
               var _t = jQuery(this);
                if(_t.find(".current-menu-item").not(".all").size()<=0){
                   _t.find(".all").addClass("current-menu-item");
                }
               title = _t.closest(".shop-widget").find(".title-text");
               if(title.find("strong").size()<=0){
                    title.html(_t.find(".current-menu-item").text())
               }else{
                    var sub = title.attr("data-sub");
                    if (typeof sub !== typeof undefined && sub !== false) {
                        if(!_t.find(".current-menu-item").hasClass("all")){
                            title.find("strong").html(_t.find(".current-menu-item").text()+" "+sub);
                        }else{
                            title.find("strong").html(_t.find(".current-menu-item").text());
                        }
                    }
                }
           })

           jQuery(".facetwp-type-checkboxes").each(function(){
            var _t = jQuery(this);
            _t.find(".facetwp-checkbox").each(function(){
                var text = jQuery(this).clone().children().remove().end().text();
                var children =  jQuery(this).clone().children();
                jQuery(this).html("");
                jQuery(this).prepend(text.toLowerCase());
                jQuery(this).append(children);
                jQuery(this).removeClass("disabled");
            })
            if(_t.find(".all").size()<=0){
                var pre_title = _t.closest(".shop-widget").find(".title-text").attr("data-all-text");
                if (typeof pre_title !== typeof undefined && pre_title !== false) {
                    var all = '<div class="all">'+pre_title+'</div>';
                }else{
                     var all = '<div class="all">All</div>';
                }
                if(_t.find(".facetwp-overflow").size()>0){
                    _t.find(".facetwp-overflow").after(all);
                }else{
                    _t.append(all);
                }

            }
            if(_t.find(".checked").not(".all").size()<=0){
               _t.find(".all").addClass("checked");
            }
            title = _t.closest(".shop-widget").find(".title-text");
            if(title.find("strong").size()<=0){
                title.html(_t.find(".checked").html())
            }else{
                var sub = title.attr("data-sub");
                if (typeof sub !== typeof undefined && sub !== false) {
                    if(!_t.find(".checked").hasClass("all")){
                        title.find("strong").html(_t.find(".checked").html()+" "+sub);
                    }else{
                        title.find("strong").html(_t.find(".checked").html());
                    }
                }
            }

        })
    })
}
window.onbeforeunload = function () {
     if(jQuery(".main-archive-page").size()>0){
            //window.scrollTo(0, 0);
     }
};

//* end shop filter custom --------------------------------------------------------------------------------------------------------------------------------------------------------*//

// education js
jQuery('document').ready(function($){
    $(".diamond-education-content .menu-left h4").click(function(e){
        $(this).parent().toggleClass("open");
    })
})

// single product js
jQuery('document').ready(function($){
    $(".skip_menu_link").on("click",function(){
        if($(".main").size()>0){
           $(".main").find("a:visible").eq(0).focus();
        }else if($("#container").size()>0){
            $("#container").find("a:visible").eq(0).focus();
        }else{
             $(".main-archive-page").find("a:visible").eq(0).focus();
        }

    })
    $(".social-share .copy").append("<span class='c-text'>Copied to your clipboard!</span>");
    $(".social-share .copy").click(function(e){
        $(this).find("input").select();
        document.execCommand('copy');
        $(this).find(".c-text").stop().fadeIn();
        setTimeout(function(){
            $(".social-share .copy .c-text").fadeOut();
        },3000)
    })

    $(".fancybox-lds-video").fancybox({
        type				: 'iframe',
		fitToView	: true,
		closeClick	: false,
		openSpeed	: 1000,
		playSpeed	:3000,
		padding:10,
		margin:10,
        autoScale: true,

        beforeLoad:function(){
             jQuery(".fancybox-overlay").addClass("lds-video");
        },
        afterLoad:function(){
             jQuery(".fancybox-overlay").addClass("lds-video");
            jQuery(".fancybox-overlay.lds-video iframe").attr("scrolling","no");
        }
	});


    if($("body.woocommerce.single-product #wrapper #content .product .right-content p.price span").size()<=0){
        $("body.woocommerce.single-product #wrapper #content .product .right-content p.price ").addClass("empty");
    }

    $(".detailt-section .detail-table").each(function(){
        if($(this).find("tr").size()>0){
            $(this).show();
        }
    })
     // remove gtm4wp_productdata class
    $("ul.products li.product").each(function(){
        $(this).find(".gtm4wp_productdata").remove();
    })
})

function replace_face_name(){
    var name = {"Old European":"Fred Leighton Round"};
    jQuery(".facetwp-radio,.facetwp-checkbox,.fs-option-label").each(function(){
        var _t = jQuery(this);
        var text = jQuery(this).clone();
        text.find(".facetwp-counter").remove();
        _name = jQuery.trim(text.text());
        if(name[_name]){
            var html = _t.html();
            html = html.replace(_name,name[_name]);
            _t.html(html);
        }
    })
}

/* fixed image height for variation slectbox changed */
jQuery(function($){
    $(document).on("after_variation_select",function(){
       var inter = setInterval(function(){
            if($("#wrapper #content .product .bx-viewport > ul li").eq(0).find("img").height()>150){
                var _height = $("#wrapper #content .product .bx-viewport > ul li").eq(0).find("img").height();
                $("#wrapper #content .product .bx-viewport").css({'height':_height})
                $("#wrapper #content .product .bx-viewport").attr('data-height',_height);
                clearInterval(inter);
            }
        },100)
    })
})

/* add sticky scroll for design your on.*/
!function(i){i.fn.theiaStickySidebar=function(t){function e(t,e){return!0===t.initialized||!(i("body").width()<t.minWidth)&&(function(t,e){t.initialized=!0,0===i("#theia-sticky-sidebar-stylesheet-"+t.namespace).length&&i("head").append(i('<style id="theia-sticky-sidebar-stylesheet-'+t.namespace+'">.theiaStickySidebar:after {content: ""; display: table; clear: both;}</style>'));e.each(function(){var e={};if(e.sidebar=i(this),e.options=t||{},e.container=i(e.options.containerSelector),0==e.container.length&&(e.container=e.sidebar.parent()),e.sidebar.parents().css("-webkit-transform","none"),e.sidebar.css({position:e.options.defaultPosition,overflow:"visible","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),e.stickySidebar=e.sidebar.find(".theiaStickySidebar"),0==e.stickySidebar.length){var a=/(?:text|application)\/(?:x-)?(?:javascript|ecmascript)/i;e.sidebar.find("script").filter(function(i,t){return 0===t.type.length||t.type.match(a)}).remove(),e.stickySidebar=i("<div>").addClass("theiaStickySidebar").append(e.sidebar.children()),e.sidebar.append(e.stickySidebar)}e.marginBottom=parseInt(e.sidebar.css("margin-bottom")),e.paddingTop=parseInt(e.sidebar.css("padding-top")),e.paddingBottom=parseInt(e.sidebar.css("padding-bottom"));var n=e.stickySidebar.offset().top,s=e.stickySidebar.outerHeight();function d(){e.fixedScrollTop=0,e.sidebar.css({"min-height":"1px"}),e.stickySidebar.css({position:"static",width:"",transform:"none"})}e.stickySidebar.css("padding-top",1),e.stickySidebar.css("padding-bottom",1),n-=e.stickySidebar.offset().top,s=e.stickySidebar.outerHeight()-s-n,0==n?(e.stickySidebar.css("padding-top",0),e.stickySidebarPaddingTop=0):e.stickySidebarPaddingTop=1,0==s?(e.stickySidebar.css("padding-bottom",0),e.stickySidebarPaddingBottom=0):e.stickySidebarPaddingBottom=1,e.previousScrollTop=null,e.fixedScrollTop=0,d(),e.onScroll=function(e){if(e.stickySidebar.is(":visible"))if(i("body").width()<e.options.minWidth)d();else{if(e.options.disableOnResponsiveLayouts){var a=e.sidebar.outerWidth("none"==e.sidebar.css("float"));if(a+50>e.container.width())return void d()}var n,s,r=i(document).scrollTop(),c="static";if(r>=e.sidebar.offset().top+(e.paddingTop-e.options.additionalMarginTop)){var p,b=e.paddingTop+t.additionalMarginTop,l=e.paddingBottom+e.marginBottom+t.additionalMarginBottom,f=e.sidebar.offset().top,h=e.sidebar.offset().top+(n=e.container,s=n.height(),n.children().each(function(){s=Math.max(s,i(this).height())}),s),g=0+t.additionalMarginTop,S=e.stickySidebar.outerHeight()+b+l<i(window).height();p=S?g+e.stickySidebar.outerHeight():i(window).height()-e.marginBottom-e.paddingBottom-t.additionalMarginBottom;var u=f-r+e.paddingTop,m=h-r-e.paddingBottom-e.marginBottom,y=e.stickySidebar.offset().top-r,k=e.previousScrollTop-r;"fixed"==e.stickySidebar.css("position")&&"modern"==e.options.sidebarBehavior&&(y+=k),"stick-to-top"==e.options.sidebarBehavior&&(y=t.additionalMarginTop),"stick-to-bottom"==e.options.sidebarBehavior&&(y=p-e.stickySidebar.outerHeight()),y=k>0?Math.min(y,g):Math.max(y,p-e.stickySidebar.outerHeight()),y=Math.max(y,u),y=Math.min(y,m-e.stickySidebar.outerHeight());var v=e.container.height()==e.stickySidebar.outerHeight();c=(v||y!=g)&&(v||y!=p-e.stickySidebar.outerHeight())?r+y-e.sidebar.offset().top-e.paddingTop<=t.additionalMarginTop?"static":"absolute":"fixed"}if("fixed"==c){var x=i(document).scrollLeft();e.stickySidebar.css({position:"fixed",width:o(e.stickySidebar)+"px",transform:"translateY("+y+"px)",left:e.sidebar.offset().left+parseInt(e.sidebar.css("padding-left"))-x+"px",top:"0px"})}else if("absolute"==c){var T={};"absolute"!=e.stickySidebar.css("position")&&(T.position="absolute",T.transform="translateY("+(r+y-e.sidebar.offset().top-e.stickySidebarPaddingTop-e.stickySidebarPaddingBottom)+"px)",T.top="0px"),T.width=o(e.stickySidebar)+"px",T.left="",e.stickySidebar.css(T)}else"static"==c&&d();"static"!=c&&1==e.options.updateSidebarHeight&&e.sidebar.css({"min-height":e.stickySidebar.outerHeight()+e.stickySidebar.offset().top-e.sidebar.offset().top+e.paddingBottom}),e.previousScrollTop=r}},e.onScroll(e),i(document).on("scroll."+e.options.namespace,function(i){return function(){i.onScroll(i)}}(e)),i(window).on("resize."+e.options.namespace,function(i){return function(){i.stickySidebar.css({position:"static"}),i.onScroll(i)}}(e)),"undefined"!=typeof ResizeSensor&&new ResizeSensor(e.stickySidebar[0],function(i){return function(){i.onScroll(i)}}(e))})}(t,e),!0)}function o(i){var t;try{t=i[0].getBoundingClientRect().width}catch(i){}return void 0===t&&(t=i.width()),t}return(t=i.extend({containerSelector:"",additionalMarginTop:0,additionalMarginBottom:0,updateSidebarHeight:!0,minWidth:0,disableOnResponsiveLayouts:!0,sidebarBehavior:"modern",defaultPosition:"relative",namespace:"TSS"},t)).additionalMarginTop=parseInt(t.additionalMarginTop)||0,t.additionalMarginBottom=parseInt(t.additionalMarginBottom)||0,function(t,o){e(t,o)||(console.log("TSS: Body width smaller than options.minWidth. Init is delayed."),i(document).on("scroll."+t.namespace,function(t,o){return function(a){var n=e(t,o);n&&i(this).unbind(a)}}(t,o)),i(window).on("resize."+t.namespace,function(t,o){return function(a){var n=e(t,o);n&&i(this).unbind(a)}}(t,o)))}(t,this),this}}(jQuery);

 __isRetina = window.devicePixelRatio > 1;
jQuery(function($){
    var DYO_bLazy =0;
    $(document).on("product_slider_loaded",function(){
         DYO_bLazy = new Blazy({
                selector:'.dyo-b-lazy',
                offset: -500
         });
    })
    $(document).on("product_slider_after",function(){
        DYO_bLazy.revalidate();
    })

    if($(".single-product #wrapper #content .product.product_cat-design-your-own").size()>0){
        $(".single-product #wrapper #content .product.product_cat-design-your-own .right-content,.single-product #wrapper #content .product.product_cat-design-your-own .diamond-details-section").wrapAll("<div class='sticky-column'></div>");$(".sticky-column").wrapInner("<div class='theiaStickySidebar'></div>");
        $('.sticky-column')
					.theiaStickySidebar({
						additionalMarginTop: 130,
                        additionalMarginBottom: -20
					});

    }
    $(".top-bar-content .fancybox-close").click(function(){
        $(this).parents(".top-bar-content").slideUp();
    })
    $(".top-bar-content a.show-more").click(function(){
        $(this).hide();
        $(this).parents(".top-bar-content").find(".show-more-text").show();
    })

    /* product catalog alt views*/
    $(document).on("touchstart touchmove mousemove",".woocommerce.archive #wrapper ul.products li.product .alt-images",function(e){
        var _t = $(this).find(".image-catalog-wrap_slider").children("img");
        if(_t.next(".catalog-image-slider").length > 0){
           var _next = _t.next(".catalog-image-slider");
           _next.addClass("loaded");
        if($(window).width()<768){
             _next.find(".image-holder").each(function(){
                 var images = $(this);
                 image = images.attr("data-image");
                 if (typeof images.attr("data-image-x2") !== typeof undefined && images.attr("data-image-x2") !== false && __isRetina) {
                      image = images.attr("data-image-x2");
                 }
                 images.html("<img src='"+image+"' alt=''>");
             })
         }
       }
    })


    $(window).on("load resize",function(){
        $(".woocommerce.archive ul.products li").each(function(){
            $(this).removeAttr("style");
             var h = $(this).outerHeight();
            $(this).css("min-height",h);
        })
    })
    $(document).on('facetwp-loaded', function() {
         $(".woocommerce.archive ul.products li").each(function(){
            $(this).removeAttr("style");
             var h = $(this).outerHeight();
            $(this).css("min-height",h);
        })
    })

    $(document).on("mouseenter",".woocommerce.archive #wrapper ul.products li.product .woocommerce-LoopProduct-link",function(e){
        var _next = $(this).find(".hover-images");
        if($(window).width()>=768){
             _next.find(".image-holder").each(function(){
                 var images = $(this);
                 image = images.attr("data-image-alt");
                 if (typeof images.attr("data-image-alt-x2") !== typeof undefined && images.attr("data-image-alt-x2") !== false && __isRetina) {
                      image = images.attr("data-image-alt-x2");
                 }
                 if(images.children("img").length<=0){
                    images.html("<img src='"+image+"' alt=''>");
                 }
             })
         }

    })

    $(document).on("mouseleave",".woocommerce.archive #wrapper ul.products li.product .woocommerce-LoopProduct-link",function(e){
        if($(window).width()>=768){
            var img_main = $(this).find(".image-catalog-wrap_slider").children("img");
            var img_hover = img_main.attr("data-first");
            var img_hover_x2 = img_main.attr("data-first-x2");
            var url = img_hover;
            if(__isRetina){
                url = img_hover_x2;
            }
            img_main.attr("src",url);
        }
    })

    $(document).on("mouseenter",".hover-images .image-holder",function(e){
        if($(window).width()>=768){
            var img_main = $(this).parents("li").find(".image-catalog-wrap_slider").children("img");
            var img_hover = $(this).attr("data-image");
            var img_hover_x2 = $(this).attr("data-image-x2");
            var url = img_hover;
            if(__isRetina){
                url = img_hover_x2;
            }
            img_main.attr("src",url);
        }
    })



    $(document).on("click",".dot-slider span",function(){
        var _p = $(this).parent(".dot-slider").prev(".image-catalog-wrap");
        $(this).parent(".dot-slider").children("span").removeClass("active");
        $(this).addClass("active");
        var _s = $(this).attr("data-slider");
        var _sw = _p.width();
        var _n = $(this).text();
        var _scroll = (_n*_sw)-_sw;
        _p.animate({"scrollLeft":_scroll},200);
        return false;
    })
    document.addEventListener('scroll', function (event) {
        if($(event.target).hasClass("image-catalog-wrap")){
            var _s_left = $(event.target).scrollLeft();
            var _dots = $(event.target).next(".dot-slider");
            var size =$(event.target).width();
            var _number = Math.floor(_s_left/size);
            _dots.find("span").removeClass("active");
            _dots.find("span").eq(_number).addClass("active");
        }

   }, true /*Capture event*/);

 /* save cart validate */
    $(document).on("submit","#modal_save_cart_form form",function(){
        var form = $(this);
        form.find("input[name='save_email']").removeClass("error");
        if(form.find("input[name='save_email']").val()=="" || !validateEmail(form.find("input[name='save_email']").val())){
            form.find("input[name='save_email']").addClass("error");
            return false;
        }
        if(form.find("input[name='save_sign_up_for_email']").prop("checked")==true && typeof freshpaint !== 'undefined'){
           freshpaint.track("Email Sign Up",{form_name:"save cart",list:"general",brand:"kwiat",value:0.00});
           if (typeof _tfa !== 'undefined') {
               _tfa.push({notify: 'event', name: 'email-signup', id: 1359333});
            }
            if (typeof gtag !== "undefined") {
                gtag('event', '"Email Sign Up', { form_name: "save cart", list: "general", brand: "kwiat", value: 0.0 });
            }
        }



        var email = form.find("input[name='save_email']").val();
        AddTrackingForAllForm(email);
    })

})

// add hubspot call back global
function AddTrackingForAllForm(email){
    // add jilt.setCustomer({ email: 'fred@example.com' })
    if (typeof jilt !== 'undefined') {
        jilt.setCustomer({ email: email });
    }
}

window.addEventListener('message', event => {
   var email = '';
   if(event.data.type === 'hsFormCallback' && event.data.eventName === 'onFormSubmit') {
       if (typeof event.data.data != "undefined") {
            Object.values(event.data.data).forEach(value=>{
                if (validateEmail(value.value)) {
                    if(email=='')
                    {
                        email = value.value;
                        AddTrackingForAllForm(email);
                    }
                }
            });
       }

   }
   //Add Workflows A/B test
   if(event.data.type === 'hsFormCallback' && event.data.eventName === 'onFormReady') {
        setWorkflow();
   }
});
function setWorkflow() {
    var groups = 2
    workflowGroup = Math.ceil(Math.random() * groups)
    jQuery('input[name="for_a_b_testing"]').val(workflowGroup).change()
}



// progress ring building bar
function capitalizeFirstLetter(string) {
  return string.replace(/\w\S*/g, function(txt){
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
}
var loose_diamonds_url = SiteUrl+'/diamond-jewelry/category/loose-diamonds/';
var engagement_rings_url = SiteUrl+'/diamond-jewelry/category/bridal/engagement-rings';
var global_ring_setting = {},global_diamond= {};
var ring_setting = {},progress_bar_obj= {};
function get_progress_bar(){
    var progress_bar = getCookie("ring_design_progress_bar_new");
    if(progress_bar){
       progress_bar = JSON.parse(progress_bar);
       progress_bar_obj = Object.assign({}, progress_bar);
    }
    return progress_bar_obj;
}
jQuery(document).ready(function($){
     jQuery(document).on("click",".message-box-bg .close",function(){
        jQuery(".message-box").hide();
     })

     jQuery(document).on("click",".close-btn",function(){
        jQuery(".message-box").hide();
        if(jQuery(".product-ldr2b-section").length>0){
            jQuery('html,body').animate({
                scrollTop: jQuery(".product-ldr2b-section").offset().top-150
            }, 'slow');
        }
     })
    // setting click
  
    jQuery(document).on("click",".ring_builder_progress_bar_enable .get-start-this-style a",function(){
        var a = jQuery(this);
        var ring_setting = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
           progress_bar_obj = Object.assign({}, progress_bar);
        }


        ring_setting.setting_price = a.attr("data-setting_price")?a.attr("data-setting_price"):"";
        //ring_setting.setting_price_format = a.attr("data-setting_price_format")?a.attr("data-setting_price_format"):"";
        ring_setting.carats_trigger = a.attr("data-carats_trigger")?a.attr("data-carats_trigger"):"";
        ring_setting.carats_trigger2 = a.attr("data-carats_trigger2")?a.attr("data-carats_trigger2"):"";
        ring_setting.additional_price = a.attr("data-additional_price")?a.attr("data-additional_price"):"";
        //ring_setting.additional_price_format = a.attr("data-additional_price_format")?a.attr("data-additional_price_format"):"";
        ring_setting.additional_price2 = a.attr("data-additional_price2")?a.attr("data-additional_price2"):"";
        //ring_setting.additional_price2_format = a.attr("data-additional_price2_format")?a.attr("data-additional_price2_format"):"";

        if(a.attr("data-carats_trigger3")!=""&&a.attr("data-additional_price3")!=""){
            ring_setting.carats_trigger3 = a.attr("data-carats_trigger3")?a.attr("data-carats_trigger3"):"";
            ring_setting.additional_price3 = a.attr("data-additional_price3")?a.attr("data-additional_price3"):"";
          //  ring_setting.additional_price3_format = a.attr("data-additional_price3_format")?a.attr("data-additional_price3_format"):"";
        }

        ring_setting.shape = a.attr("data-shape")?a.attr("data-shape"):"";
        ring_setting.image_alt = a.attr("data-image_alt")?a.attr("data-image_alt"):"";
        ring_setting.image_altx2 = a.attr("data-image_altx2")?a.attr("data-image_altx2"):"";
        ring_setting.image_grid = a.attr("data-image_grid")?a.attr("data-image_grid"):"";
        ring_setting.image_gridx2 = a.attr("data-image_gridx2")?a.attr("data-image_gridx2"):"";
        ring_setting.product_title = a.attr("data-product_title")?a.attr("data-product_title"):"";
        ring_setting.product_link = a.attr("data-product_link")?a.attr("data-product_link"):"";
        ring_setting.product_id = a.attr("data-product_id")?a.attr("data-product_id"):"";
        ring_setting.product_var_id = a.attr("data-product_var_id")?a.attr("data-product_var_id"):"";
        progress_bar_obj._ring_setting = ring_setting;


        if(progress_bar_obj._diamond!==undefined&&progress_bar_obj._diamond.shape!==ring_setting.shape){
            var _engagement_rings_url = SiteUrl+'/diamond-engagement-rings/#bridal-start-setting-tabs';
            if(progress_bar_obj!==undefined&&progress_bar_obj._diamond!==undefined){
                _engagement_rings_url = SiteUrl+"/diamond-jewelry/engagement-rings/diamond-shape/"+progress_bar_obj._diamond.shape;
            }
            var _shape = progress_bar_obj._diamond.shape;
            var __shape = capitalizeFirstLetter(_shape.toString().replace(/-/g, ' '));
            var html ='<div class="message-box-bg"><div class="message-box-inner"><a class="close"><span class="close new_icon-close"></span></a>';
            html +=   '<div class="icon"><img src="https://kwiat.com/wp-content/themes/shop/site-2.0/img/ring.svg" alt=""></div>';
            html +=   '<div class="title">OOPS!</div>';
            html +=   '<div class="message-content">This ring setting doesn’t work with the <strong>'+__shape+'</strong> diamond you previously selected. </div>';
            html +=   '<div class="message-buttons two">';
            html +=   '<a class="btn blue" href="'+_engagement_rings_url+'">Choose an '+__shape+' setting </a>';
            html +=   '<a class="btn blue-black keep-this-setting-btn load-diamond" href="javascript:;">Continue with this ring</a>';
            html +=   '</div>';
            html +=   '</div></div>';
            show_messagebox(0,html);
            global_ring_setting = ring_setting;
            return false;
        }


        if(progress_bar!==undefined&&progress_bar._ring_setting!==undefined){
            var html ='<div class="message-box-bg"><div class="message-box-inner"><a class="close"><span class="close new_icon-close"></span></a>';
            html +=   '<div class="icon"><img src="https://kwiat.com/wp-content/themes/shop/site-2.0/img/ring.svg" alt=""></div>';
            html +=   '<div class="title">YOU ALREADY CHOSE A SETTING</div>';
            html +=   '<div class="message-content">But you’re welcome to change your mind!</div>';
            html +=   '<div class="message-buttons two">';
            html +=   '<a class="btn blue close-btn load-diamond" href="javascript:;">Keep original setting</a>';
            html +=   '<a class="btn blue-black keep-this-setting-and-diamond load-diamond" href="javascript:;">Proceed with new setting</a>';
            html +=   '</div>';
            html +=   '</div></div>';
            show_messagebox(0,html);
            global_ring_setting = ring_setting;
            return false;
        }
        if(progress_bar_obj._diamond===undefined){
            window.location.href = progress_bar_obj._ring_setting.product_link+'diamond-selection/';
            show_messagebox(0,html);
        }
        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname)
        custom_block( jQuery( 'section.main' ) );
        load_progress_data_from_cookie(function(){
            custom_unblock( jQuery( 'section.main' ) );
             if(progress_bar_obj._diamond!==undefined){
                 //jQuery(".ring-progress-bar .step-3").click()
                 window.location.href = progress_bar_obj._ring_setting.product_link+'complete-ring/';
             }
        });

    });
     jQuery(document).on("click",".keep-this-setting-and-diamond",function(){
        var a = jQuery(this);
        var ring_setting = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
            progress_bar_obj = Object.assign({}, progress_bar);
        }
        progress_bar_obj._ring_setting = global_ring_setting;
        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname);
        custom_block( jQuery( 'section.main' ) );
        load_progress_data_from_cookie(function(){
            custom_unblock( jQuery( 'section.main' ) );
            var progress_bar_obj = get_progress_bar();
             if(progress_bar_obj._diamond!==undefined){
                if(progress_bar_obj){
                    window.location.href = progress_bar_obj._ring_setting.product_link+'complete-ring/';
                }
             }
        });
        jQuery(".message-box").hide();
        global_ring_setting = {};
        var progress_bar_obj = get_progress_bar();
        if(progress_bar_obj){
            window.location.href = progress_bar_obj._ring_setting.product_link+'diamond-selection/';
        }
        return false;
     })
     jQuery(document).on("click",".keep-this-setting-btn",function(){
        var a = jQuery(this);
        var ring_setting = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
            progress_bar_obj = Object.assign({}, progress_bar);
        }
        delete progress_bar_obj._diamond;
        progress_bar_obj._ring_setting = global_ring_setting;
        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname);
        load_progress_data_from_cookie();
        jQuery(".message-box").hide();
        global_ring_setting = {};
         var progress_bar_obj = get_progress_bar();
        if(progress_bar_obj._diamond!==undefined){
            if(progress_bar_obj){
                window.location.href = progress_bar_obj._ring_setting.product_link+'diamond-selection/';
            }
         }
        return false;
     })


    // diamond click
    jQuery(document).on("click",".ring_builder_progress_bar_enable .ldr2b-addtocart-lds, .ring_builder_progress_bar_enable .select_dieamond_add_to_cart",function(){
        var a = jQuery(this);
        var diamond = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
       
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
            progress_bar_obj = Object.assign({}, progress_bar);
        }
        diamond.id = a.attr("data-id")?a.attr("data-id"):"";
        diamond.image = a.attr("data-image")?a.attr("data-image"):"";
        diamond.string = a.attr("data-string")?a.attr("data-string"):"";
        var _title = a.attr("data-title")?a.attr("data-title"):"";
        diamond.title = _title.replace("#","______").replace(",","_____");
        diamond.title2 = a.attr("data-title-2")?a.attr("data-title-2"):"";
        diamond.cer = a.attr("data-cer")?a.attr("data-cer"):"";
        diamond.carats = a.attr("data-carats")?a.attr("data-carats"):"";
        diamond.shape = a.attr("data-shape")?a.attr("data-shape"):"";
        diamond.price = a.attr("data-price")?a.attr("data-price"):"";
        diamond.color = a.attr("data-color-name")?a.attr("data-color-name"):"";
        diamond.clarity = a.attr("data-clarity-name")?a.attr("data-clarity-name"):"";
        //diamond.price_format = a.attr("data-price-format")?a.attr("data-price-format"):"";
        diamond.link = a.attr("data-link")?a.attr("data-link"):"";
        progress_bar_obj._diamond = diamond;

        if(progress_bar_obj._ring_setting!==undefined&&progress_bar_obj._ring_setting.shape!==diamond.shape){
            var _loose_diamonds_url = loose_diamonds_url;
            var _engagement_rings_url = SiteUrl+'/diamond-engagement-rings/#bridal-start-setting-tabs';

            if(progress_bar!==undefined&&progress_bar._ring_setting!==undefined){                
                _loose_diamonds_url = loose_diamonds_url+"?fwp_shape="+progress_bar._ring_setting.shape;
                _engagement_rings_url = SiteUrl+"/diamond-jewelry/engagement-rings/diamond-shape/"+diamond.shape;
               
            }
            var _shape = progress_bar_obj._ring_setting.shape;            
            var __shape = capitalizeFirstLetter(_shape.toString().replace(/-/g, ' '));
            var html ='<div class="message-box-bg"><div class="message-box-inner"><a class="close"><span class="close new_icon-close"></span></a>';
            html +=   '<div class="icon"><img src="https://kwiat.com/wp-content/themes/shop/site-2.0/img/diamond.svg" alt=""></div>';
            html +=   '<div class="title">OOPS!</div>';
            html +=   '<div class="message-content">This diamond doesn’t work with the <stong>'+__shape+'</strong> ring setting you previously selected.</div>';
            html +=   '<div class="message-buttons two">';
            html +=   '<a class="btn blue" href="'+_loose_diamonds_url+'">Choose a '+__shape+' diamond</a>';
            html +=   '<a class="btn blue-black keep-this-diamond-btn" href="'+_engagement_rings_url+'">Continue with this diamond</a>';
            html +=   '</div>';
            html +=   '</div></div>';
            show_messagebox(0,html);
            global_diamond = diamond;
            return false;
        }
        if(progress_bar!==undefined&&progress_bar._diamond!==undefined){
            var html ='<div class="message-box-bg"><div class="message-box-inner"><a class="close"><span class="close new_icon-close"></span></a>';
            html +=   '<div class="icon"><img src="https://kwiat.com/wp-content/themes/shop/site-2.0/img/diamond.svg" alt=""></div>';
            html +=   '<div class="title">YOU ALREADY CHOSE A DIAMOND</div>';
            html +=   '<div class="message-content">But you’re welcome to change your mind!</div>';
            html +=   '<div class="message-buttons two">';
            html +=   '<a class="btn blue close-btn" href="javascript:;">Keep original diamond</a>';
            html +=   '<a class="btn blue-black keep-this-diamond-and-setting" href="javascript:;">Proceed with new diamond</a>';
            html +=   '</div>';
            html +=   '</div></div>';
            show_messagebox(0,html);
            global_diamond = diamond;
            return false;
        }
        if(progress_bar_obj._ring_setting===undefined){
            var _engagement_rings_url = SiteUrl+'/diamond-engagement-rings/#bridal-start-setting-tabs';
            if(progress_bar_obj!==undefined&&progress_bar_obj._diamond!==undefined){
                _engagement_rings_url = SiteUrl+"/diamond-jewelry/engagement-rings/diamond-shape/"+progress_bar_obj._diamond.shape;               
            }
            var html ='<div class="message-box-bg"><div class="message-box-inner"><a class="close"><span class="close new_icon-close"></span></a>';
            html +=   '<div class="icon"><img src="https://kwiat.com/wp-content/themes/shop/site-2.0/img/ring.svg" alt=""></div>';
            html +=   '<div class="title">NICE CHOICE!</div>';
            html +=   '<div class="message-content">We’ve got your diamond. Now choose your setting.</div>';
            html +=   '<div class="message-buttons two">';
            html +=   '<a class="btn blue-black" href="'+_engagement_rings_url+'">Choose setting</a>';
            html +=   '</div>';
            html +=   '</div></div>';
            show_messagebox(0,html);
        }

        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname);
        custom_block( jQuery( 'section.main' ) );
        load_progress_data_from_cookie(function(){
            custom_unblock( jQuery( 'section.main' ) );
             if(progress_bar_obj._ring_setting!==undefined){
                 //jQuery(".ring-progress-bar .step-3").click()
                  window.location.href = progress_bar_obj._ring_setting.product_link+'/complete-ring/';
             }
        });
        return false;
    })
    jQuery(document).on("click",".keep-this-diamond-and-setting",function(){
        var a = jQuery(this);
        var ring_setting = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
           progress_bar_obj = Object.assign({}, progress_bar);
        }
        progress_bar_obj._diamond = global_diamond;
        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname);
        custom_block( jQuery( 'section.main' ) );
        load_progress_data_from_cookie(function(){
            custom_unblock( jQuery( 'section.main' ) );
             if(progress_bar_obj._ring_setting!==undefined){
                 //jQuery(".ring-progress-bar .step-3").click()
                  window.location.href = progress_bar_obj._ring_setting.product_link+'complete-ring/';
             }
        });
        jQuery(".message-box").hide();
        global_diamond = {};
        return false;
     })
    jQuery(document).on("click",".keep-this-diamond-btn",function(){
        var a = jQuery(this);
        var ring_setting = {},progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
           progress_bar_obj = Object.assign({}, progress_bar);
        }
        delete progress_bar_obj._ring_setting;
        progress_bar_obj._diamond = global_diamond;
        createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname);
        load_progress_data_from_cookie();
        jQuery(".message-box").hide();
        global_diamond = {};
        var progress_bar_obj = get_progress_bar();
        window.location.href = jQuery(this).attr("href");
        return false;
     })


    // remove click
    jQuery(document).on("click",".ring_builder_progress_bar_enable .ring-progress-bar .step-link-2",function(){
        var a = jQuery(this);
        var progress_bar_obj= {};
        var progress_bar = getCookie("ring_design_progress_bar_new");
        if(progress_bar){
           progress_bar = JSON.parse(progress_bar);
           progress_bar_obj = Object.assign({}, progress_bar);
           if(a.attr("data-step")=="_diamond"){
                 delete progress_bar_obj._diamond;
           }
           if(a.attr("data-step")=="_ring_setting"){
                 delete progress_bar_obj._ring_setting;
           }
           createCookie("ring_design_progress_bar_new", JSON.stringify(progress_bar_obj), 7, window.location.hostname)
        }


        load_progress_data_from_cookie()
        return false;
    })

    $(document).on("click",".load-diamond",function(){
        var progress_bar_obj = get_progress_bar();
        if(progress_bar_obj){
            window.location.href = progress_bar_obj._ring_setting.product_link+'diamond-selection/';
        }
    })
    if(jQuery(".ring_builder_progress_bar_enable").length>0 && jQuery(".ring-progress-bar").length >0 ){
        load_progress_data_from_localStoge();
    }
    
    $(".f-top .f-top-left .new-navi >li>a").click(function(){
        $(this).parent().toggleClass("open");
        return false;
    })
})
function load_progress_data_from_localStoge (){
    var progress_bar_local = get_progress_bar();
    // load step 1
    var step1_link = SiteUrl+"/diamond-engagement-rings#bridal-start-setting-tabs";
    if(progress_bar_local._diamond){
         step1_link = SiteUrl+"/diamond-jewelry/engagement-rings/diamond-shape/"+progress_bar_local._diamond.shape;
    }
    var step1 = "<a class='step step-1' href='"+step1_link+"'>";    
        step1 +="<span class='_icon2020-ring1 icon'></span>";  
        step1 +="<div class='step-content'>";  
        step1 +="    <div class='step-title'>CHOOSE A SETTING</div>";                  
        step1 +="</div>";  
        step1 +="</a>";      
    if(progress_bar_local._ring_setting){
        var title = progress_bar_local._ring_setting.product_title;
        var link = progress_bar_local._ring_setting.product_link;
            step1 = "<div class='step step-1 active' >";
            step1 +="<span class='_icon2020-ring1 icon'></span>";
            step1 +="    <div class='step-content'>";                   
            step1 +="        <div class='step-links'>";
            step1 +="        <div class='step-link-1-wrap'><a class='step-link-1' href='"+link+"'>"+title+"</a></div>";
            step1 +="        <a class='step-link-2' href='#' data-step='_ring_setting'>Remove</a>";
            step1 +="        </div>";
            step1 +="    </div>";                
            step1 +="</div>";        
    }
    jQuery(".ring-progress-bar .step.step-1").replaceWith(step1);
    // load step 2
    var step2_link = SiteUrl+"/diamond-jewelry/category/loose-diamonds/";
    if(progress_bar_local._ring_setting){        
        step2_link = SiteUrl+"/diamond-jewelry/category/loose-diamonds/?fwp_shape="+progress_bar_local._ring_setting.shape;       
    }
    var step2 = "<a class='step step-2' href='"+step2_link+"'>";    
        step2 +="<span class='_icon2020-diamond icon'></span>";  
        step2 +="<div class='step-content'>";  
        step2 +="    <div class='step-title'>CHOOSE A CENTER DIAMOND</div>";                  
        step2 +="</div>";  
        step2 +="</a>"; 
    if(progress_bar_local._diamond){
        var title = progress_bar_local._diamond.title2;
        var link = progress_bar_local._diamond.link;
            step2 = "<div class='step step-2 active' >";
            step2 +="<span class='_icon2020-diamond icon'></span>";
            step2 +="    <div class='step-content'>";                   
            step2 +="        <div class='step-links'>";
            step2 +="        <div class='step-link-1-wrap'><a class='step-link-1' href='"+link+"'>"+title+"</a></div>";
            step2 +="        <a class='step-link-2' href='#' data-step='_diamond'>Remove</a>";
            step2 +="        </div>";
            step2 +="    </div>";                
            step2 +="</div>";        
    }
    jQuery(".ring-progress-bar .step.step-2").replaceWith(step2);
    // load step 3
    if(progress_bar_local._ring_setting && progress_bar_local._diamond){        
        var link = progress_bar_local._ring_setting.product_link+"complete-ring";
        var step3 = "<div class='step step-3 active' >";
            step3 +="<span class='_icon2020-ring1 icon'></span>";
            step3 +="    <div class='step-content'>";                   
            step3 +="        <div class='step-links'>";
            step3 +="        <div class='step-link-1-wrap'><a class='step-link-1' href='"+link+"'>Complete ring</a></div>";
            step3 +="        </div>";
            step3 +="    </div>";                
            step3 +="</div>"; 
        jQuery(".ring-progress-bar .step.step-3").remove();
        jQuery(".ring-progress-bar .step.step-2").after(step3);
        jQuery(".ring-progress-bar").addClass("complete-active");
    }
}

function load_progress_data_from_cookie_no_loading(callback){
    jQuery.ajax({
        type : "post",
        dataType : "html",
        url : SiteAjaxUrl,
        data : {
            action: "get_progress_bar_data",
        },
        success: function(response) {
            //localStorage.setItem("progress_bar",JSON.stringify(response));
           // console.log("set-local");
            jQuery(".ring-progress-bar-wrap").replaceWith(jQuery(response).find(".ring-progress-bar-wrap"));
            jQuery(document).trigger("progress_bar_reinit");
            jQuery(document).trigger("finished_cookie");
            if (typeof callback == "function"){
                callback();
            }
        }
    })
}
function load_progress_data_from_cookie(callback){
    custom_block( jQuery( 'div.ring-progress-bar' ) );
    jQuery.ajax({
        type : "post",
        dataType : "html",
        url : SiteAjaxUrl,
        data : {
            action: "get_progress_bar_data",
        },
        success: function(response) {
            //localStorage.setItem("progress_bar",JSON.stringify(response));
           // console.log("set-local");
            jQuery(".ring-progress-bar-wrap").replaceWith(jQuery(response).find(".ring-progress-bar-wrap"));
            jQuery(document).trigger("progress_bar_reinit");
            jQuery(document).trigger("finished_cookie");
            if (typeof callback == "function"){
                callback();
            }
        }
    })
}

function show_messagebox(auto_close=1,message=''){
    html='<div class="message-box">'+message+'</div>';
    jQuery("body").append(html);
}
jQuery(function(_j){
    _j(document).on('click','.ldr2b-add-setting-to-cart',function(){
        var _this = _j(this).parents("form.cart");
        var flag = 0;
        _this.find('.required-product-addon').removeClass('error');
        _this.find('.required-product-addon').each(function(){
            var _t = _j(this);
            if(_t.find('select').val()==''){
               flag =1;
               _t.addClass('error') ;
            }
            if(_t.find('input').val()==''){
               flag =1;
                _t.addClass('error') ;
            }
        })
        if(flag==0){
            _j.fancybox.close();
            _j('body').append('<div class=\"loading add_to_cart_loading\"></div>');
            _j.ajax({
                type : 'post',
                dataType : 'html',
                url : SiteAjaxUrl,
                data:_this.serialize(),
                success: function(response) {
                      if(response==1){
                          createCookie('ring_design_progress_bar_new', '', 7, window.location.hostname);
                          load_progress_data_from_cookie();
                          _j(document).trigger("add_to_cart_done");
                      }else{
                          _j('.add_to_cart_loading').remove();
                          _j('.woocommerce-notices-wrapper').remove();
                          _j('.ring-progress-bar').before('<div class=\"woocommerce-notices-wrapper\"><ul class=\"woocommerce-error\" role=\"alert\"><li><strong>Error:</strong>  Please try again!</li></ul></div>');

                          _j('html,body').animate({
                                scrollTop: _j('#content').offset().top-150
                            }, 'slow');
                      }
                }
            })
        }
        return false;

    })
    })

jQuery(document).on("click",".content-accordion .ui-accordion-header",function(){
    if(!jQuery(this).hasClass("ui-state-active")){
        jQuery(this).parents(".content-accordion").children("div").hide();
        jQuery(this).parents(".content-accordion").children("div").removeClass("ui-state-active-content");
        jQuery(this).parents(".content-accordion").children(".ui-accordion-header").not(jQuery(this)).removeClass("ui-state-active");
        jQuery(this).next().slideDown().addClass("ui-state-active-content");
        jQuery(this).addClass("ui-state-active");
    }else{
        jQuery(this).next().slideUp().removeClass("ui-state-active-content");
        jQuery(this).removeClass("ui-state-active");
    }
})

// Ajax add to cart;
jQuery(document).ready(function(_j){
     _j(document).on("change","form.cart .product-addon-ring-size select",function(){
          if(_j(this).val()!==""){
               _j(this).parents(".product-addon-ring-size").removeClass("error");
          }
     })
    _j(document).on("submit","body.woocommerce.single-product #wrapper #content .d-content form.cart",function(){
        _j('body').append('<div class=\"loading add_to_cart_loading\"></div>');
        _j("#content > .woocommerce-notices-wrapper").remove();
        if(_j(this).find(".product-addon-ring-size select").val()==""){
            _j(this).find(".product-addon-ring-size").addClass("error");
            //return false;
        }
        var url = _j(this).attr("action");
        _j.ajax({
            type : 'post',
            dataType : 'html',
            url : url,
            data: _j(this).serialize(),
            success: function(response) {
                  if(_j(response).find(".woocommerce-error").length>0){
                     _j("#content").prepend(_j(response).find(".woocommerce-notices-wrapper"));
                     _j('html, body').animate({
                            scrollTop: _j(".woocommerce-notices-wrapper").offset().top-100
                     }, 500);
                     _j('body > .add_to_cart_loading').remove();
                  }else{
                      _j(document).trigger("add_to_cart_done");
                      _j('body > .add_to_cart_loading').remove();
                  }
            }
        })
        return false;
    });
    _j(document).on("submit",".add-cart-message-box form",function(){
        var form = _j(this);
        if(form.find("input[name='save_email']").val()=="" || !validateEmail(form.find("input[name='save_email']").val())){
            form.find("input[name='save_email']").addClass("error");
            return false;
        }
    })

    // stud add to cart
    _j(document).on("click",".cart-area .add-to-cart .btn-cta, .product-listing .add-to-cart .btn-cta, #results-popup .custom-product-list ul.products li.product .add-to-cart a,body.woocommerce.single-product #content .product .right-content .add-to-cart a.black-bt.bt",function(){
         var url = _j(this).attr("href");
        _j('body').append('<div class=\"loading add_to_cart_loading\"></div>');
        _j.ajax({
            type : 'post',
            url : url
        }).always(function(jqXHR, textStatus) {
           if(textStatus=="success"){
               _j(document).trigger("add_to_cart_done");
               _j('body > .add_to_cart_loading').remove();
           }
        });
        return false;
    })
})

jQuery(document).on("add_to_cart_done",function(){
    jQuery('body > .add_to_cart_loading').remove();
    jQuery.fancybox.open({
        href  : '#add-card-modal',
        type : 'inline',
        padding: 0
     });
    var freshpaint_add_to_cart = getCookie("_pintrk_data");
    if(freshpaint_add_to_cart){
       freshpaint_add_to_cart = JSON.parse(decodeURIComponent(freshpaint_add_to_cart));
       if (typeof freshpaint !== 'undefined') {
          freshpaint.track("Add to cart",freshpaint_add_to_cart);
          document.cookie = '_pintrk_data=""; Path=/;';
       }
    }

    var ga_add_to_cart = getCookie("_ga_data");
    if(ga_add_to_cart){
       ga_add_to_cart = JSON.parse(decodeURIComponent(ga_add_to_cart));
       if (typeof gtag !== 'undefined') {
          gtag('event', 'Add to cart', ga_add_to_cart);
          document.cookie = '_ga_data=""; Path=/;';
       }
    }
    refrest_mini_cart();
})

var custom_block = function( node ) {

        node.addClass( 'processing' ).block( {
            message: null,
            overlayCSS: {
                background: '#fff',
                opacity: 0.6
            }
        } );

};

/**
 * Unblock a node after processing is complete.
 *
 * @param {JQuery Object} $node
 */
var custom_unblock = function( node ) {
    node.removeClass( 'processing' ).unblock();
};
jQuery( document ).on('submit','form.c-woocommerce-shipping-calculator',function(evt){
        evt.preventDefault();
        var jQueryform = jQuery( evt.currentTarget );

        custom_block( jQuery( 'div.cart_totals' ) );

        // Provide the submit button value because wc-form-handler expects it.
        jQuery( '<input />' ).attr( 'type', 'hidden' )
                        .attr( 'name', 'calc_shipping' )
                        .attr( 'value', 'x' )
                        .appendTo( jQueryform );

        // Make call to actual form post URL.
        jQuery.ajax( {
            type:     jQueryform.attr( 'method' ),
            url:      jQueryform.attr( 'action' ),
            data:     jQueryform.serialize(),
            dataType: 'html',
            success:  function( response ) {
                tax = jQuery(response).find(".cart-collaterals .tax-total.no-border .amount").text().replace("$","");
                if(tax==0||tax=="0"){
                    jQuery(".cart-collaterals .tax-total.no-border td").html("No tax on this order.");
                }else{
                    jQuery(".cart-collaterals .tax-total.no-border").html(jQuery(response).find(".cart-collaterals .tax-total.no-border").html());
                }

                jQuery(".cart-collaterals .order-total").html(jQuery(response).find(".cart-collaterals .order-total").html());

            },
            complete: function() {
                custom_unblock( jQueryform );
                custom_unblock( jQuery( 'div.cart_totals' ) );
            }
        } );
})
jQuery(document).on("updated_cart_totals ready",function(){
    if(jQuery(".woocommerce-cart ul#shipping_method li input").length>0){
        var shipping = jQuery(".woocommerce ul#shipping_method li input:checked").val();

        if(shipping.search("free_shipping")!=-1){
            jQuery(".woocommerce-cart .c-woocommerce-shipping-calculator").addClass("shipping");
        }else{
            jQuery(".woocommerce-cart .c-woocommerce-shipping-calculator").addClass("pickup");
            jQuery(".woocommerce-cart #calc_shipping_postcode").val("10065");
            jQuery(".woocommerce-cart #calc_shipping_button").trigger("click");
        }
    }
})



// add Concierge events
jQuery(document).ready(function($){
    jQuery(document).on("click",".live-chat-a, .live-chat a, .concierge-live-chat-track a, .default-banner-top .input-field .submit, a.Request-Pricing, .concierge-email-track a, .concierge-call-track a, .concierge-text-track a,  .concierge-schedule-appt-track a, .hubspot-click a, .google-track-click a, a[data-klaviyo-form], .tracking-find-ring-size", function(){
        if (typeof freshpaint !== 'undefined') {
            var text = jQuery(this).text();
            var label = '';
            if(text.indexOf("EMAIL")!=-1){
                label ='email-inquiry';
            }else if(text.indexOf("CALL")!=-1){
                label ='call-us';
            }else if(text.indexOf("TEXT")!=-1){
                label ='text-us';
            }else if(text.indexOf("CHAT")!=-1){
                label ='live-chat';
            }else if(text.indexOf("SCHEDULE")!=-1){
                label = 'schedule-appointment';
            }else if(text.indexOf("submit")!=-1){
                label = 'zip-code-searched';
            }else if(text.indexOf("Pricing")!=-1){
                label = 'request-pricing';
            }else if(text.indexOf("Chat")!=-1){
                label ='live-chat';
            }else if(text.indexOf("Text")!=-1){
                label ='text-us';
            }else if(text.indexOf("Inquiry")!=-1){
               label ='email-inquiry';
            }else if(text.indexOf("your size")!=-1){
               label ='find-ring-size';
            }
            if(label!=''){
                freshpaint.track("Concierge Clicked",{channel:label});
                if (typeof gtag !== "undefined") {
                    gtag('event', "Concierge Clicked",{"channel":label});                             
                }  
            }
        }
    })

    //sync the klaviyo auto identify from email clicks with freshpaint.
    var str = window.location.href,
    rex = /(["'>:]?)([\w.-]+@[\w.-]+\.[\w.-]+)/gi,
    __email = '';
    str = str.replace( rex, function ( $0, $1 ) {
        __email = $0
    });
    if(__email!=""&& validateEmail(__email)){
         if (typeof freshpaint !== 'undefined') {
           freshpaint.identify(__email);
           freshpaint.track("Identified User",{"email":__email});
        }
        if (typeof gtag !== "undefined") {
            gtag('event', "Identified User",{"email":__email});
        }
        if (typeof ORIBI !== 'undefined') {
            ORIBI.api("setUserEmail", __email);
        }
        if (typeof _tfa !== 'undefined') {
           _tfa.push({notify: 'event', name: 'identified-user', id: 1359333});
        }
     }
    if (js_GET('_ke')!=""){
        var string_param = js_GET('_ke');
        if(string_param.search("%")!==-1){
            string_param = string_param.substring(0, string_param.indexOf('%'));
        }
        var obj = JSON.parse(b64DecodeUnicode(string_param));
        var email = obj.kl_email;
         if(email!=""&& validateEmail(email)){
             if (typeof freshpaint !== 'undefined') {
               freshpaint.identify(email);
               freshpaint.track("Identified User",{"email":email});
            }
            if (typeof gtag !== "undefined") {
                gtag('event', "Identified User",{"email":email});
            }
            if (typeof ORIBI !== 'undefined') {
                ORIBI.api("setUserEmail", email);
            }
            if (typeof _tfa !== 'undefined') {
               _tfa.push({notify: 'event', name: 'identified-user', id: 1359333});
            }
         }

    }
})

function b64DecodeUnicode(str) {
    // Going backwards: from bytestream, to percent-encoding, to original string.
    return decodeURIComponent(atob(str).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
}
// klaviyoForms submited
window.addEventListener("klaviyoForms", function(e) {
    if(e.detail.type == 'submit'){
        jQuery(document).trigger('klaviyoForms_submit', [e]);
    }
});
jQuery(document).on("klaviyoForms_submit",function(e,form){
    _title = '';
    switch(form.detail.formId) {
      case 'UyAk3g':
        _title = 'Catalog Request'
        break;
      case 'RRhTir':
        _title = 'Engagement Rings - Request Pricing'
        break;
      case 'WrQJeY':
        _title = 'General - Request Pricing'
        break;
      case 'SX8u5G':
        _title = 'Contact Us'
        break;
      case 'TLgdwW':
        _title = 'Schedule Viewing'
        break;
      case 'TxzitH':
        _title = 'Find Ring Size'
        break;
    }
    if (typeof ORIBI !== 'undefined' && _title !='') {
       var ori_text = "Concierge Form - " + _title + " - Submitted";
       ORIBI.api('track',ori_text);
    }
    if (typeof freshpaint !== 'undefined' && _title !='' ) {
       var obj = {"contactType": "Form","formName": _title,"value":'0.00',"currency": 'USD'};
       freshpaint.track("Concierge Contacted", obj);
    }
    if (typeof gtag !== "undefined") {
       var GAobj = {"contactType": "Form","formName": _title,"value":0.00};
       gtag('event', "Concierge Contacted",GAobj);
    }
    if (typeof _tfa !== 'undefined') {
        _tfa.push({notify: 'event', name: 'concierge-contacted', id: 1359333});
     }

    //pass email sign up - if checkbox on catalog request is checked
    if((Array.isArray(form.detail.metaData.KwiatEmailList) && form.detail.metaData.KwiatEmailList.length > 0 ) || form.detail.formId=="SSCXmK" || form.detail.formId=="XRBLrC" ){
          if (typeof freshpaint !== 'undefined' && typeof form.detail.metaData.$source !== 'undefined') {
            freshpaint.track("Email Sign Up",{form_name:form.detail.metaData.$source,list:"general",brand:"kwiat",value:0.00});
            if (typeof gtag !== "undefined") {
               gtag('event', "Email Sign Up",{form_name:form.detail.metaData.$source,list:"general",brand:"kwiat",value:0.00});
            }
            if (typeof _tfa !== 'undefined') {
               _tfa.push({notify: 'event', name: 'email-signup', id: 1359333});
            }
         }
    }
})

// calendly events handle
window.addEventListener(
  'message',
  function(e) {
    if (e.data.event=="calendly.event_scheduled") {
        if (typeof ORIBI !== 'undefined') {
           var ori_text = "Concierge - Appointment Created";
           ORIBI.api('track',ori_text);
        }
        if (typeof freshpaint !== 'undefined') {
           var obj = {"contactType": "Form","formName": 'Scheduled Appointment',"value":'0.00', "currency": 'USD'};
           freshpaint.track("Concierge Contacted", obj);
           freshpaint.track("Scheduled Appointment", obj);
        }
        if (typeof gtag !== "undefined") {
          gtag('event', "Concierge Contacted",{"contactType": "Form","formName": 'Scheduled Appointment',"value":0.00});
          gtag('event', "Scheduled Appointment",{"contactType": "Form","formName": 'Scheduled Appointment',"value":0.00});
        }
        if (typeof _tfa !== 'undefined') {
            _tfa.push({notify: 'event', name: 'concierge-contacted', id: 1359333});
            _tfa.push({notify: 'event', name: 'scheduled-appointment', id: 1359333});
        }
    }
  }
);

// function refrest mini cart add_to_cart_done
function clear_cookie(name){
    var date = new Date();
    date.setTime(date.getTime()+(1));
    var expires = "; expires="+date.toGMTString();
    document.cookie = name+"="+expires+"; path=/";
}
jQuery(document).ready(function(){
     jQuery(".link-panel").addClass("loaded");
     var woocommerce_items_in_cart = getCookie("woocommerce_items_in_cart");
     if(woocommerce_items_in_cart!=1){
         localStorage.removeItem("mini_cart");
     }
     read_mini_cart_from_local();
})
jQuery(document).on("add_to_cart_done",function(){
    refrest_mini_cart();
})
jQuery(window).load(function(){
     var woocommerce_remove_cart_item_updated = getCookie("woocommerce_remove_cart_item_updated");
     if(woocommerce_remove_cart_item_updated==1){
          refrest_mini_cart();
          clear_cookie('woocommerce_remove_cart_item_updated')
     };

})
function refrest_mini_cart(){
    jQuery.ajax({
        type : "post",
        dataType : "html",
        url : SiteAjaxUrl,
        data : {
            action: "refrest_mini_cart",
        },
        success: function(response) {
           if(jQuery(".wraper-cart").length>0){
               jQuery(".wraper-cart").replaceWith(response)
           }else{
                jQuery("#cart-link").after(response)
           }
           var total=jQuery(".wraper-cart .link").data("total");
           if(total==0||!total){
                jQuery(".h-widget a.cart-item").parent("li").addClass("no-item")
           }
           jQuery(".h-widget  a.cart-item span").text(total);
           var bLazy_cart = new Blazy({loadInvisible: true,selector: '.b-lazy-cart'});
           bLazy_cart.revalidate();
           jQuery(".link-panel").addClass("loaded");
           var cart_html = jQuery("#cart-link").parent().html();
           localStorage["mini_cart"] = JSON.stringify(cart_html);
           read_mini_cart_from_local();
        }
    })
}
function read_mini_cart_from_local(){
    var cart_html = jQuery("#cart-link").parent();
    if (typeof localStorage.getItem("mini_cart")  !== 'undefined' && localStorage.getItem("mini_cart")  !== null){
         var tempsave = JSON.parse(localStorage.getItem("mini_cart"));
         cart_html.html(tempsave);
         var bLazy_cart = new Blazy({loadInvisible: true,selector: '.b-lazy-cart'});
         bLazy_cart.revalidate();
    }else{
         cart_html.find(".totals").text(0);
         cart_html.find(".wraper-cart").remove();
    }
}
// search from tracking
jQuery(document).on("submit",".search-icon form",function(){
    if (typeof freshpaint !== 'undefined') {
       var value = jQuery(this).find("input[name='s']").val();
       var obj = {"search_string": value};
       freshpaint.track("Search", obj);
       if (typeof gtag !== "undefined") {
            gtag('event', "Search",obj);
        }
    }
})
