!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){t.fn.zoomIt=function(o){var i={enabled:1,status:0,loaded:0,img:t(this),offset:[0,0],"class":{container:"zoomit-container",loaded:"loaded",img:"zoomit-zoomed",ghost:"zoomit-ghost"},src:function(){return this.img.data("zoomed")},getSrc:function(){return"function"==typeof this.src?this.src():this.src},imgTag:null};o=t.extend(i,o),o.execute=function(t){"string"==typeof t&&"function"==typeof o[t]&&o[t](o)},o.getContainer=function(){return t('<div class="'+o["class"].container+'"></div>')},o.getImgSrc=function(){return null===o.imgTag&&(o.imgTag=t("<img />").addClass(o["class"].img).attr("src",this.getSrc()),"undefined"!=typeof o.img.attr("alt")&&o.imgTag.attr("alt",o.img.attr("alt"))),o.imgTag},o.getZoomInstance=function(){return o.img.parent().find("."+o["class"].img)},o.restrict=function(t){return t>1?t=1:0>t&&(t=0),t},o.getDimensions=function(){o.position={img:{width:o.img.width(),height:o.img.height(),offset:o.img.offset()},zoom:{width:o.getZoomInstance().width(),height:o.getZoomInstance().height()}}},o.setPosition=function(t){"undefined"!=typeof t.originalEvent&&(t=t.originalEvent),0===o.loaded&&o.getDimensions(),o.img.parent().addClass(o["class"].loaded),o.loaded=1,o.position.x=o.restrict((t.pageX-o.position.img.offset.left)/o.position.img.width),o.position.y=o.restrict((t.pageY-o.position.img.offset.top)/o.position.img.height),o.position.zoom.offset={left:(o.position.zoom.width-o.position.img.width)*o.position.x,top:(o.position.zoom.height-o.position.img.height)*o.position.y},o.getZoomInstance().css({transform:"translate(-"+o.position.zoom.offset.left+"px, -"+o.position.zoom.offset.top+"px)"})},o.show=function(t){!o.enabled||1===o.status&&0===o.loaded||(o.status=1,0==o.img.parent().find("."+o["class"].img).length?(o.img.after(o.getImgSrc()),o.getZoomInstance().on("load",function(){o.setPosition(t)}).each(function(){this.complete&&o.setPosition(t)})):o.setPosition(t),o.execute("onZoomIn"))},o.hide=function(){o.status=0,o.loaded=0,o.imgTag=null,o.img.parent().removeClass(o["class"].loaded),o.getZoomInstance().remove(),o.execute("onZoomOut")},o.move=function(t){o.status&&o.show(t)},o.enable=function(){o.enabled=1},o.disable=function(){o.enabled=0},o.init=function(){o.img.wrap(o.getContainer()).after('<div class="'+o["class"].ghost+'"></div>'),o.ghost=o.img.parent().find("."+o["class"].ghost),o.ghost.on("mouseenter touchstart",function(t){o.show(t)}).on("mouseleave touchend",function(){o.hide()}).on("mousemove touchmove",function(t){t.stopPropagation(),t.preventDefault(),o.move(t)}).on("click",function(){o.execute("onClick")}),o.execute("onInit")},o.img.data("zoom",o),o.init()}});


jQuery(document).ready(function($){
    var img_size = $("div.thumbnails ul > *").size();
    if(img_size==1){
        $("div.thumbnails ul").addClass("one-image");
    }
    $(document).on("click",".zoom-page",function(){
        
       var index = $(this).attr("data-loop"); 
       var source = $(this).parents(".thumbnails").html();    
       if($(".images-lightbox").length<=0){
           initLightbox(index,source);
       }else{
           $(".images-lightbox").removeClass("hide-it");
           scrollToIndex(index);
       } 
       return false;    
    });
    
    $(document).on("click",".images-lightbox-inner .bx-wrapper .bx-viewport ul li._image",function(){
        $(this).addClass("zoom-active");
    });
    $(document).on("click mouseout",".zoomit-container",function(){
        $(this).parents("li").removeClass("zoom-active");
    })
    $(document).on("click",".images-lightbox .close",function(){
        $(this).parent(".images-lightbox").remove();
        $(document).trigger("popup_close");
    })
    $(document).on("click",".images-lightbox-inner #bx-pager a",function(){               
        var index = $(this).attr("data-slide-index");        
        scrollToIndex(index);
        return false;
    })
    $(document).on("after_variation_select",function(){
         $(".images-lightbox").remove();
         var img_size = $("div.thumbnails ul > *").size();
        if(img_size==1){
            $("div.thumbnails ul").addClass("one-image");
        }
    });
    $('.product-selectbox-wrap .dropdown-shape select').select2({
        dropdownParent:$(".product-selectbox-wrap .dropdown-shape"),
        minimumResultsForSearch: -1,
        templateResult: function (data, container) {
            if (data.element) {
              $(container).attr('data-value',$(data.element).attr("data-class"));
            }            
            return data.text;
        }
    });
    
    $('.product-selectbox-wrap .dropdown-metal select').select2({
        dropdownParent:$(".product-selectbox-wrap .dropdown-metal"),
        minimumResultsForSearch: -1,
        templateResult: function (data, container) {
            if (data.element) {
              $(container).attr('data-value',$(data.element).attr("data-class"));
            }            
            return data.text;
      }
    });
    
    $('.product-selectbox-wrap .dropdown-band-width select').select2({
        dropdownParent:$(".product-selectbox-wrap .dropdown-band-width"),
        minimumResultsForSearch: -1,
        templateResult: function (data, container) {
            if (data.element) {
              $(container).attr('data-value',$(data.element).attr("data-class"));
            }            
            return data.text;
      }
    });
    $('form.cart .product-addon-ring-size select').each(function(){
        var _select = $(this);
        _select.select2({
            dropdownParent:_select.parents(".form-row"),
            minimumResultsForSearch: -1,
            templateResult: function (data, container) {
               if (data.element) {
                      $(container).attr('data-value',data.text);
                    }            
                    return data.text;
              }
        });
    })    
    $('.variations_wrapper .variations select').select2({
        dropdownParent:$(".variations_wrapper"),
        minimumResultsForSearch: -1,
        
    });
    
    $('.product-selectbox-wrap select').change(function(){
        if($(this).val()!=""){
            window.location.href= $(this).val();
        }
    })
    
    $(".benefits-slider .slider").slick({
          slidesToShow: 4,
         
          arrows:false,
          dots: false,        
          responsive: [
            {
              breakpoint: 768,
              settings: {
                centerMode: true,  
                dots: true,
                centerPadding: '20',
                slidesToShow: 2
              }
            },
            {
              breakpoint: 480,
              settings: {
                centerMode: true,  
                dots: true,
                centerPadding: '20',
                slidesToShow: 1
              }
            }
          ]
        });
    

    $(document).click(function (e){
        var container = $(".images-lightbox-inner");
        if (!container.is(e.target) && container.has(e.target).length === 0){
           $(".images-lightbox").remove();            
           $(document).trigger("popup_close"); 
        }
    });
    $(document).on("popup_close",function(){
        $(".images-lightbox-inner .bx-wrapper .bx-viewport ul li iframe").each(function(){
           var src = $(this).attr("src");
           $(this).attr("src",src);
        });
    })
    $(document).on("click",".diamond-color-clarity-box:not(.no-hover) .-title a",function(){
        return false;
    })
    $(document).on("click",".diamond-color-clarity-box:not(.no-hover) .-title",function(){
        $(this).parent().toggleClass("hover");
    })
})

function initLightbox(index,source){
    custom_block( jQuery( '.product .images div.thumbnails' ) );
    var template_html = '<div class="images-lightbox"><div class="close"></div><div class="images-lightbox-inner"></div></div>';    
    var _temp = jQuery(template_html);
    _temp.find(".images-lightbox-inner").html(source);
    _temp.find(".contact-box").remove();
    _temp.find("._image").each(function(){
        var href = jQuery(this).find("a").attr("href");
        jQuery(this).find("img").removeClass("b-lazy").removeClass("b-loaded");
        jQuery(this).find("img").attr("src",href);
        jQuery(this).find("img").attr("data-zoomed",href);
    })
    var totalImages = _temp.find("._image img").length,imagesLoaded=0;
    _temp.find("._image img").on('load',function() {
        imagesLoaded++;
        if (imagesLoaded == totalImages) {
            _temp.find(".blockUI").remove();
            custom_unblock( jQuery( '.product .images div.thumbnails' ) );
            jQuery("body").append(_temp);
            scrollToIndex(index);
            var bLazy = new Blazy();
            bLazy.revalidate();
        }
        jQuery(this).zoomIt();  
        
    })
}

function scrollToIndex(index){
     var element = $(".images-lightbox-inner li[data-loop='"+index+"']");
        if(element.length>0){
            jQuery(".images-lightbox-inner #bx-pager a").removeClass("active");
            jQuery(".images-lightbox-inner #bx-pager a[data-slide-index='"+index+"']").addClass("active");
            jQuery(".images-lightbox-inner .bx-wrapper .bx-viewport ul").animate({scrollTop:(element.offset().top-jQuery("html,body").scrollTop())+jQuery(".images-lightbox-inner .bx-wrapper .bx-viewport ul").scrollTop()});
           
        }
}